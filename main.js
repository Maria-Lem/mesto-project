(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}var n=function(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))},r=function(e,t,n){e?t.textContent="Сохранение...":(t.classList.add("form__submit_disabled"),t.setAttribute("disabled",!0),t.textContent=n)},o=document.querySelector("#cardBlockTemplate").content,a=document.querySelector(".popup_type_card"),c=document.querySelector(".popup__image"),i=document.querySelector(".popup__caption");function u(t,n,r,u,s,l,d,f,m,p){var _=o.cloneNode(!0),v=_.querySelector(".card__title"),y=_.querySelector(".card__image"),h=_.querySelector(".button__heart-img"),b=_.querySelector(".button__likes-number"),S=_.querySelector(".button_type_delete");return v.textContent=t,y.src=n,y.alt=t,b.textContent=r,u.some((function(e){return e._id===s}))&&h.classList.add("button_active"),s!==l?S.classList.remove("button_visible"):(S.classList.add("button_visible"),S.addEventListener("click",(function(e){return f(d,e.target)}))),h.addEventListener("click",(function(e){h.classList.contains("button_active")?p(d,b,e.target):m(d,b,e.target)})),y.addEventListener("click",(function(){c.src=n,c.alt=t,i.textContent=t,e(a)})),_}var s={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"11a4c094-1331-44b4-8d63-0b635dd3a5c6","Content-Type":"application/json"}},l=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},d=function(){return fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then(l)},f=function(e,t,n){var r=t.querySelector(n.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(r.classList.remove(n.inactiveButtonClass),r.removeAttribute("disabled")):(r.classList.add(n.inactiveButtonClass),r.setAttribute("disabled",!0))};function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);c=!0);}catch(e){i=!0,o=e}finally{try{c||null==n.return||n.return()}finally{if(i)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _,v=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_add"),h=document.querySelector(".popup_type_avatar"),b=document.querySelectorAll(".popup"),S=document.querySelector(".button_type_edit"),L=document.querySelector(".form__submit-edit"),q=document.querySelector(".button_type_add"),C=document.querySelector(".form__submit-add"),E=document.querySelector(".profile__pic-container"),k=document.querySelector(".form__submit-avatar"),g=document.forms.editProfilePopup,A=document.forms.addCardPopup,x=document.forms.changeAvatarPopup,P=g.elements.userName,U=g.elements.userOccupation,w=A.elements.photoName,T=A.elements.photoLink,O=x.elements.avatarLink,j=document.querySelector(".profile__name"),B=document.querySelector(".profile__occupation"),N=document.querySelector(".profile__pic"),D=document.querySelector(".cards"),I=function(e,t){(function(e){return fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then(l)})(e).then((function(){t.closest(".card").remove()}))},J=function(e,t,n){(function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then(l)})(e).then((function(e){t.textContent=e.likes.length,n.classList.add("button_active")}))},H=function(e,t,n){(function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers}).then(l)})(e).then((function(e){t.textContent=e.likes.length,n.classList.remove("button_active")}))};Promise.all([d(),fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then(l)]).then((function(e){var t=m(e,2),n=t[0],r=t[1];j.textContent=n.name,B.textContent=n.about,N.src=n.avatar,r.forEach((function(e){D.append(u(e.name,e.link,e.likes.length,e.likes,n._id,e.owner._id,e._id,I,J,H))}))})),S.addEventListener("click",(function(){P.value=j.textContent,U.value=B.textContent,e(v)})),q.addEventListener("click",(function(){e(y)})),E.addEventListener("click",(function(){e(h)})),b.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_opened")&&t(e),n.target.classList.contains("button_type_close")&&t(e)}))})),g.addEventListener("submit",(function(){var e,n;r(!0,L),(e=P.value,n=U.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:n})}).then(l)).then((function(e){var n,r;n=e.name,r=e.about,j.textContent=n,B.textContent=r,t(v)})).finally((function(){r(!1,L,"Сохранить")}))})),A.addEventListener("submit",(function(){var e,n;r(!0,C),Promise.all([d(),(e=w.value,n=T.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:n})}).then(l))]).then((function(e){var n=m(e,2),r=n[0],o=n[1];D.prepend(u(o.name,o.link,o.likes.length,o.likes,r._id,o.owner._id,o._id)),t(y),A.reset()})).finally((function(){r(!1,C,"Создать")}))})),x.addEventListener("submit",(function(){r(!0,k),function(e){return fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(l)}(O.value).then((function(e){N.src=e.avatar,t(h),x.reset()})).finally((function(){r(!1,k,"Сохранить")}))})),_={formSelector:".popup__form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){var t=Array.from(e.querySelectorAll(_.inputSelector));e.addEventListener("submit",(function(n){n.preventDefault(),f(t,e,_)})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));f(n,e,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),f(n,e,t)}))}))}(e,_)}))})();